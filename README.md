# üîó Doctor Link Tracker

![Status](https://img.shields.io/badge/status-production_ready-green)
![Python](https://img.shields.io/badge/python-3.12+-blue)
![Docker](https://img.shields.io/badge/docker-required-blue)

–°–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Å—ã–ª–∫–∞–º –¥–ª—è –≤—Ä–∞—á–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—Ç—á–µ—Ç–∞–º–∏ –≤ Telegram.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üöÄ **–ë—ã—Å—Ç—Ä—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã** - FastAPI —Å async/await
- üìä **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- üì± **Telegram –æ—Ç—á–µ—Ç—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
- üé® **–ö—Ä–∞—Å–∏–≤—ã–π CLI** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å Rich
- üê≥ **Docker** - –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- üíæ **SQLite** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚è∞ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  FastAPI Web ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   SQLite    ‚îÇ
‚îÇ   /code     ‚îÇ      ‚îÇ  (redirect)  ‚îÇ      ‚îÇ  Database   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                      ‚ñ≤
                            ‚îÇ                      ‚îÇ
                            ‚ñº                      ‚îÇ
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
                     ‚îÇ  Background  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ  Click Log   ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ APScheduler ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Telegram   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Doctor    ‚îÇ
‚îÇ  (cron)     ‚îÇ      ‚îÇ     Bot      ‚îÇ      ‚îÇ   Reports   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     CLI     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Database   ‚îÇ
‚îÇ   (Typer)   ‚îÇ      ‚îÇ   (manage)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** >= 20.10
- **Docker Compose** >= 2.0
- Telegram –±–æ—Ç —Ç–æ–∫–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <repository-url>
cd url_shortener
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
make init

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env
nano .env
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env`:**

```bash
# Server
PORT=8000
DATABASE_PATH=/app/data/links.db

# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here

# Reports
DAILY_REPORT_TIME=09:00
WEEKLY_REPORT_DAY=monday
WEEKLY_REPORT_TIME=09:00
TIMEZONE=Europe/Moscow
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
make up

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
make health

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make logs
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: **http://localhost:8000**

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### CLI –∫–æ–º–∞–Ω–¥—ã

#### –°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É

```bash
make create CODE=ivanov URL=https://instagram.com/dr_ivanov TITLE="–î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤"
```

–ò–ª–∏ —á–µ—Ä–µ–∑ docker compose –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker compose exec web uv run python -m src.cli create ivanov https://instagram.com/dr_ivanov --title "–î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤"
```

#### –û–±–Ω–æ–≤–∏—Ç—å URL

```bash
make update CODE=ivanov URL=https://new-url.com
```

#### –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É

```bash
make delete CODE=ivanov
```

#### –û–±–Ω—É–ª–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

```bash
# –° –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
make reset-clicks CODE=ivanov

# –ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤)
make reset-clicks CODE=ivanov FORCE=1
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∫–ª–∏–∫–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∫–ª–∏–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
make clicks CODE=ivanov

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∫–ª–∏–∫–æ–≤
make clicks CODE=ivanov LIMIT=50
```

#### –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫

```bash
make list
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ

```bash
# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
make stats CODE=ivanov

# –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
make stats CODE=ivanov DAYS=30
```

#### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤ (IP, –±—Ä–∞—É–∑–µ—Ä, –∏—Å—Ç–æ—á–Ω–∏–∫)

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∫–ª–∏–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
make clicks CODE=ivanov

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∫–ª–∏–∫–æ–≤
make clicks CODE=ivanov LIMIT=50
```

–í—ã–≤–æ–¥–∏—Ç —Ç–∞–±–ª–∏—Ü—É —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–∂–¥–æ–º –∫–ª–∏–∫–µ:
- ‚è∞ –í—Ä–µ–º—è –∫–ª–∏–∫–∞ (–¥–æ —Å–µ–∫—É–Ω–¥)
- üåê IP –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üíª User Agent (–±—Ä–∞—É–∑–µ—Ä/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
- üîó Referer (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏)

#### –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –≤—Ä—É—á–Ω—É—é

```bash
# –î–Ω–µ–≤–Ω–æ–π –æ—Ç—á–µ—Ç
make report-daily

# –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
make report-weekly
```

### HTTP API

#### –†–µ–¥–∏—Ä–µ–∫—Ç

```bash
GET /{code}
```

–ü—Ä–∏–º–µ—Ä:
```bash
curl -L http://localhost:8000/ivanov
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (JSON)

```bash
GET /api/links/{code}/stats
```

–ü—Ä–∏–º–µ—Ä:
```bash
curl http://localhost:8000/api/links/ivanov/stats
```

#### Health Check

```bash
GET /health
```

–ü—Ä–∏–º–µ—Ä:
```bash
curl http://localhost:8000/health
```

## üìä Telegram –æ—Ç—á–µ—Ç—ã

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 24 —á–∞—Å–∞
üìÖ 06.11.2025
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë®‚Äç‚öïÔ∏è –î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤
‚îú‚îÄ –°–µ–≥–æ–¥–Ω—è: 23 üëÜ
‚îú‚îÄ –í—Å–µ–≥–æ: 1,247
‚îî‚îÄ +5% üìà

üë®‚Äç‚öïÔ∏è –î–æ–∫—Ç–æ—Ä –ü–µ—Ç—Ä–æ–≤
‚îú‚îÄ –°–µ–≥–æ–¥–Ω—è: 15 üëÜ
‚îú‚îÄ –í—Å–µ–≥–æ: 892
‚îî‚îÄ -2% üìâ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–í—Å–µ–≥–æ: 38 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
```

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏:

```
üìà –û—Ç—á–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é
üìÖ 28.10 - 03.11.2025
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë®‚Äç‚öïÔ∏è –î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤
‚îú‚îÄ –ó–∞ –Ω–µ–¥–µ–ª—é: 156 üëÜ
‚îú‚îÄ –í –¥–µ–Ω—å: ~22.3
‚îî‚îÄ –í—Å–µ–≥–æ: 1,247

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üèÜ –¢–û–ü —Å—Å—ã–ª–æ–∫:

1Ô∏è‚É£ –î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤ ‚Üí 156
2Ô∏è‚É£ –î–æ–∫—Ç–æ—Ä –ü–µ—Ç—Ä–æ–≤ ‚Üí 103
3Ô∏è‚É£ –î–æ–∫—Ç–æ—Ä –°–∏–¥–æ—Ä–æ–≤ ‚Üí 87

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–í—Å–µ–≥–æ –∑–∞ –Ω–µ–¥–µ–ª—é: 346 –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫
make up

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make restart

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!)
make rebuild

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make logs              # –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs-web          # –¢–æ–ª—å–∫–æ web
make logs-scheduler    # –¢–æ–ª—å–∫–æ scheduler

# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make shell

# –û—Ç–∫—Ä—ã—Ç—å SQLite –∫–æ–Ω—Å–æ–ª—å
make db-shell

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ backup –¥–∞–Ω–Ω—ã—Ö
make check-data        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ë–î
make backup            # –°–æ–∑–¥–∞—Ç—å backup

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
make clean
```

### Docker Compose –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º –ª–æ–≥–æ–≤
docker compose up

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f web
docker compose logs -f scheduler

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart web
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # FastAPI —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ cli.py            # CLI –∫–æ–º–∞–Ω–¥—ã (Typer)
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # Async SQLite –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ telegram.py       # Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py      # APScheduler
‚îÇ   ‚îî‚îÄ‚îÄ config.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile        # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ data/                 # –î–∞–Ω–Ω—ã–µ (volume)
‚îÇ   ‚îî‚îÄ‚îÄ links.db          # SQLite –±–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ pyproject.toml        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (uv)
‚îú‚îÄ‚îÄ Makefile              # –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ .env                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram

### 1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞

1. –ù–∞–ø–∏—à–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **—Ç–æ–∫–µ–Ω –±–æ—Ç–∞**

### 2. –ü–æ–ª—É—á–∏—Ç—å Chat ID

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –±–æ—Ç–∞**

1. –ù–∞–ø–∏—à–∏—Ç–µ [@userinfobot](https://t.me/userinfobot)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à **ID**

**–°–ø–æ—Å–æ–± 2: –î–ª—è –≥—Ä—É–ø–ø—ã**

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```
4. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":...}` –≤ –æ—Ç–≤–µ—Ç–µ

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env

```bash
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=123456789
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

```bash
make report-daily
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞

**–¢–∞–±–ª–∏—Ü–∞ `links`:**
- `id` - INTEGER PRIMARY KEY
- `short_code` - TEXT UNIQUE NOT NULL
- `target_url` - TEXT NOT NULL
- `title` - TEXT
- `created_at` - TIMESTAMP
- `updated_at` - TIMESTAMP

**–¢–∞–±–ª–∏—Ü–∞ `clicks`:**
- `id` - INTEGER PRIMARY KEY
- `link_id` - INTEGER (FK ‚Üí links.id)
- `clicked_at` - TIMESTAMP (—Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∫–ª–∏–∫–∞)
- `user_agent` - TEXT (–±—Ä–∞—É–∑–µ—Ä/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- `ip_address` - TEXT (IP –∞–¥—Ä–µ—Å)
- `referer` - TEXT (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∫–ª–∏–∫–æ–≤:**
```bash
# –ß–µ—Ä–µ–∑ CLI
make clicks CODE=ivanov LIMIT=50

# –ß–µ—Ä–µ–∑ SQL
make db-shell
sqlite> SELECT clicked_at, ip_address, user_agent FROM clicks WHERE link_id = 1;
```

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î

```bash
# –ß–µ—Ä–µ–∑ Makefile
make db-shell

# –ß–µ—Ä–µ–∑ docker compose
docker compose exec web sqlite3 /app/data/links.db

# SQL –∑–∞–ø—Ä–æ—Å—ã
sqlite> SELECT * FROM links;
sqlite> SELECT COUNT(*) FROM clicks WHERE link_id = 1;
sqlite> .quit
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose logs -f

# –¢–æ–ª—å–∫–æ web server
docker compose logs -f web

# –¢–æ–ª—å–∫–æ scheduler
docker compose logs -f scheduler

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker compose logs --tail=100 web
```

### –ú–µ—Ç—Ä–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost:8000/health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ
curl http://localhost:8000/api/links/ivanov/stats | jq

# –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤
make clicks CODE=ivanov LIMIT=50
```

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
make logs

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make rebuild

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
cat .env
```

### –ü—Ä–æ–±–ª–µ–º–∞: Telegram –æ—Ç—á–µ—Ç—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ chat_id –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:
   ```bash
   make logs-scheduler
   ```
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç:
   ```bash
   make report-daily
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make restart

# –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
make down
make up
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç 8000 –∑–∞–Ω—è—Ç

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `.env`:
```bash
PORT=8080
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
make restart
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# –°–æ–∑–¥–∞—Ç—å backup –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
make backup

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)
make rebuild

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
make health
make check-data
```

## üì¶ Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°–æ–∑–¥–∞—Ç—å backup

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup —Å timestamp
make backup

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
cp data/links.db data/links.db.backup.$(date +%Y%m%d)

# –ò–ª–∏ —á–µ—Ä–µ–∑ tar
tar -czf backup-$(date +%Y%m%d).tar.gz data/
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
cp data/links.db.backup.20251106 data/links.db

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
make up
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make check-data

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª—ã
ls -lh data/
```

**–í–∞–∂–Ω–æ:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `data/links.db` –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (bind mount).  
–ü—Ä–∏ `make rebuild` –¥–∞–Ω–Ω—ã–µ **–ù–ï —É–¥–∞–ª—è—é—Ç—Å—è**! ‚úÖ

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–º. [DATA_PERSISTENCE.md](DATA_PERSISTENCE.md)

## üöÄ Production deployment

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ nginx —Å SSL
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** - –¥–æ–±–∞–≤—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è API
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Prometheus/Grafana
4. **Backup** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î
5. **–õ–æ–≥–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ELK stack –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏

### –ü—Ä–∏–º–µ—Ä nginx –∫–æ–Ω—Ñ–∏–≥–∞

```nginx
server {
    listen 80;
    server_name links.example.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª [Troubleshooting](#-troubleshooting)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `make logs`
3. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## üéâ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ç—Ä–µ—Ö –≤—Ä–∞—á–µ–π
make create CODE=ivanov URL=https://instagram.com/dr_ivanov TITLE="–î–æ–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤"
make create CODE=petrov URL=https://vk.com/dr_petrov TITLE="–î–æ–∫—Ç–æ—Ä –ü–µ—Ç—Ä–æ–≤"
make create CODE=sidorov URL=https://t.me/dr_sidorov TITLE="–î–æ–∫—Ç–æ—Ä –°–∏–¥–æ—Ä–æ–≤"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏
make list

# –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
make stats CODE=ivanov DAYS=30

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–ª–∏–∫–æ–≤ (IP, –±—Ä–∞—É–∑–µ—Ä, –≤—Ä–µ–º—è)
make clicks CODE=ivanov LIMIT=50

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
make report-daily
```

–¢–µ–ø–µ—Ä—å –ø–∞—Ü–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Å—ã–ª–∫–∞–º:
- http://localhost:8000/ivanov
- http://localhost:8000/petrov
- http://localhost:8000/sidorov

–ò –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ Telegram! üìä

---

**–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –≤—Ä–∞—á–µ–π**


