# ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞

## üêå –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ `docker compose up -d`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```
[+] Running 2/3
 ‚úî Network url_shortener_default  Created   0.1s
 ‚†á Container linktrack-web        Waiting   29.8s  ‚Üê –î–æ–ª–≥–æ!
 ‚úî Container linktrack-scheduler  Created   0.0s
```

`linktrack-scheduler` –∂–¥—ë—Ç, –ø–æ–∫–∞ `linktrack-web` —Å—Ç–∞–Ω–µ—Ç "healthy".

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)

### 1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω healthcheck

**–ë—ã–ª–æ:**
```yaml
healthcheck:
  interval: 30s    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥
  timeout: 10s
  retries: 3
```

**–°—Ç–∞–ª–æ:**
```yaml
healthcheck:
  interval: 5s      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
  timeout: 3s       # –ë—ã—Å—Ç—Ä—ã–π —Ç–∞–π–º–∞—É—Ç
  retries: 3
  start_period: 40s # –ù–µ —Å—á–∏—Ç–∞–µ–º –ø—Ä–æ–≤–∞–ª—ã –ø–µ—Ä–≤—ã–µ 40 —Å–µ–∫—É–Ω–¥
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –¥–æ 30 —Å–µ–∫—É–Ω–¥, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥!

### 2. start_period –¥–æ–±–∞–≤–ª–µ–Ω

- –ü–µ—Ä–≤—ã–µ 40 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–ø—Ä–æ–≥—Ä–µ–≤–∞–µ—Ç—Å—è"
- –ü—Ä–æ–≤–∞–ª—ã healthcheck –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è
- –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ healthy

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞):
```bash
docker compose build    # 20-60 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
docker compose up -d    # 5-15 —Å–µ–∫—É–Ω–¥
```

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏:
```bash
docker compose up -d    # 3-7 —Å–µ–∫—É–Ω–¥
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
```bash
docker compose restart  # 2-5 —Å–µ–∫—É–Ω–¥
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫
docker compose up

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –õ–æ–≥–∏ web
docker compose logs -f web

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: –°—Ç–∞—Ç—É—Å
watch -n 1 'docker compose ps'
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ –¥–æ–ª–≥–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
# –ó–∞—Å–µ—á—å –≤—Ä–µ–º—è
time docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health
docker compose ps

# –ö–æ–≥–¥–∞ web —Å—Ç–∞–Ω–µ—Ç healthy, scheduler –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

#### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –æ–¥–∏–Ω —Ä–∞–∑
docker compose build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä
docker images | grep linktrack

# –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑
docker compose up -d
```

#### 2. –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å scheduler –æ—Ç web (–µ—Å–ª–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

–ï—Å–ª–∏ scheduler –º–æ–∂–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:

```yaml
scheduler:
  depends_on:
    - web  # –ü—Ä–æ—Å—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ health
```

–ò–ª–∏ –≤–æ–æ–±—â–µ —É–±—Ä–∞—Ç—å:

```yaml
scheduler:
  # depends_on –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
```

#### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workers –¥–ª—è uvicorn (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```yaml
web:
  command: uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --workers 2
```

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç:

```bash
# 1. –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
time docker compose build

# 2. –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
time docker compose up -d

# 3. –õ–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ web
docker compose logs web | grep -E "(Starting|started|Uvicorn running)"

# 4. –°—Ç–∞—Ç—É—Å healthcheck
docker inspect linktrack-web --format='{{json .State.Health}}' | jq

# 5. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ healthy
docker compose events --json | jq 'select(.status=="health_status")'
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:

```bash
# –ó–∞—Å–µ—á—å –Ω–∞—á–∞–ª–æ
START=$(date +%s)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d

# –î–æ–∂–¥–∞—Ç—å—Å—è healthy
while [ "$(docker inspect linktrack-web --format='{{.State.Health.Status}}')" != "healthy" ]; do
  sleep 1
done

# –ó–∞—Å–µ—á—å –∫–æ–Ω–µ—Ü
END=$(date +%s)
echo "–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: $((END - START)) —Å–µ–∫—É–Ω–¥"
```

## üéØ –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–∏–µ–º–ª–µ–º–æ |
|----------|-------|-----------|
| –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ | 30-60s | ‚úÖ |
| docker compose build | 10-30s | ‚úÖ |
| docker compose up -d | 5-10s | ‚úÖ |
| docker compose restart | 3-5s | ‚úÖ |
| Healthcheck —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è green | 5-15s | ‚úÖ |

## ‚ö†Ô∏è –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫ > 30 —Å–µ–∫—É–Ω–¥

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ù–µ—Ç –ª–∏ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é/DNS:**
   ```bash
   docker compose logs web | grep -i error
   ```

2. **–•–≤–∞—Ç–∞–µ—Ç –ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤:**
   ```bash
   docker stats --no-stream
   ```

3. **–ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   ```bash
   docker compose logs web --tail 100
   ```

4. **–†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ /health endpoint:**
   ```bash
   docker compose exec web curl -f http://localhost:8000/health
   ```

5. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ .env:**
   ```bash
   docker compose exec web env | grep -E "(HOST|PORT|DATABASE)"
   ```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```yaml
# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫, –±–µ–∑ healthcheck
depends_on:
  - web
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```yaml
# –° healthcheck –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
depends_on:
  web:
    condition: service_healthy
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞:

```python
# src/main.py
import time
start_time = time.time()

@app.on_event("startup")
async def startup():
    logger.info(f"Started in {time.time() - start_time:.2f}s")
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# 1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
docker compose build

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
docker compose down

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –∑–∞—Å–µ–∫–∏—Ç–µ
time docker compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 5-10 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 30+
```

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º! üöÄ

