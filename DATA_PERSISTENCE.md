# üíæ –°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

## –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `data/links.db` –Ω–∞ —Ö–æ—Å—Ç–µ –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ **bind mount**:

```yaml
volumes:
  - ./data:/app/data
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ **–í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –≤ –ø–∞–ø–∫–µ `data/`.

## ‚úÖ –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —É–¥–∞–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ

```bash
make restart     # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make rebuild     # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make down        # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make up          # –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose restart
docker compose down
docker compose build
```

**–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è!** ‚úÖ

## ‚ö†Ô∏è –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

### `make clean` - —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
```bash
make clean
# –°–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
# –£–¥–∞–ª—è–µ—Ç Docker volumes, –Ω–æ –ù–ï —É–¥–∞–ª—è–µ—Ç data/links.db
```

### –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
```bash
rm data/links.db  # ‚ùå –£–¥–∞–ª—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!
rm -rf data/      # ‚ùå –£–¥–∞–ª—è–µ—Ç –≤—Å—é –ø–∞–ø–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏!
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –±–∞–∑—ã
```bash
make check-data
```

–í—ã–≤–æ–¥:
```
üìä Data Directory Status:

‚úì data/ directory exists
-rw-r--r-- 1 user staff 16K Nov 7 18:00 links.db

‚úì Database file: data/links.db
16K    data/links.db
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
```bash
ls -la data/
```

## üíæ Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°–æ–∑–¥–∞—Ç—å backup
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup —Å timestamp
make backup

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
cp data/links.db data/links.db.backup.$(date +%Y%m%d)
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª
cp data/links.db.backup.20251107 data/links.db

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
make up
```

### Backup –ø–µ—Ä–µ–¥ rebuild
```bash
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
make backup
make rebuild
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
data/
‚îú‚îÄ‚îÄ .gitkeep                        # –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞–ø–∫–∏ –≤ git
‚îú‚îÄ‚îÄ links.db                        # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
‚îú‚îÄ‚îÄ links.db.backup.20251107_1200  # Backups (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ links.db.backup.20251106_0900
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∞–Ω–Ω—ã–º

### –†–∞–∑–º–µ—Ä –±–∞–∑—ã
```bash
du -h data/links.db
```

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
```bash
make db-shell
sqlite> SELECT COUNT(*) FROM links;
sqlite> SELECT COUNT(*) FROM clicks;
sqlite> .quit
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ backups**
   ```bash
   # –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
   0 3 * * * cd /path/to/url_shortener && make backup
   ```

2. **Permissions**
   ```bash
   chmod 600 data/links.db  # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å
   ```

3. **Git ignore**
   ```bash
   # –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ .gitignore
   data/*.db
   data/*.db-*
   ```

## ‚ùì FAQ

### Q: –î–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–ª–∏ –ø–æ—Å–ª–µ `make rebuild`?
**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
make check-data
ls -la data/
```

–î–∞–Ω–Ω—ã–µ –î–û–õ–ñ–ù–´ –±—ã—Ç—å —Ç–∞–º. –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç:
1. –í–æ–∑–º–æ–∂–Ω–æ, –±–∞–∑–∞ –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ –ø—É—Ç—å `DATABASE_PATH=/app/data/links.db`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ `data/`

### Q: –ö–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?
**A:** 
```bash
make down
rm -f data/links.db
make up
```

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker volume –≤–º–µ—Å—Ç–æ bind mount?
**A:** –î–∞, –Ω–æ bind mount —É–¥–æ–±–Ω–µ–µ –¥–ª—è backup –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º:
```yaml
# –í–∞—Ä–∏–∞–Ω—Ç —Å named volume (—Å–ª–æ–∂–Ω–µ–µ –¥–µ–ª–∞—Ç—å backup)
volumes:
  - db_data:/app/data

volumes:
  db_data:
```

### Q: –ì–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–∞–∑–∞ –Ω–∞ macOS?
**A:** –í –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞: `/Users/aleksandrmotor/code/life/url_shortener/data/links.db`

## üîÑ –ü–æ—Å–ª–µ rebuild

```bash
# 1. –°–¥–µ–ª–∞—Ç—å backup
make backup

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
make rebuild

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
make check-data

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
make list
```

–í—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è! ‚úÖ

